<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">

<!-- ★ Google Search Console 所有権確認 ★ -->
<meta name="google-site-verification"
content="googleaf7ef497ef5f9795.html">

<title>腕立て伏せ自動カウンター｜カメラで回数を数える無料Webアプリ</title>

<meta name="description"
content="スマホやPCのカメラで腕立て伏せの回数を自動でカウントできる無料Webアプリ。MediaPipe姿勢推定を使用。インストール不要。">

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="robots" content="index, follow">

<link rel="canonical" href="https://muscle-trainer.github.io/pushupcounter/googleaf7ef497ef5f9795.html">

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>

<style>
body {
  font-family: system-ui, sans-serif;
  margin: 0;
  padding: 12px;
  background: #f5f5f5;
  text-align: center;
}

h1 { font-size: 1.6rem; }

#container {
  position: relative;
  max-width: 480px;
  margin: 0 auto;
}

video, canvas {
  width: 100%;
  border-radius: 12px;
}

canvas {
  position: absolute;
  left: 0;
  top: 0;
}

.counter {
  font-size: 2rem;
  margin: 10px 0;
}

button, input {
  font-size: 1rem;
  padding: 8px;
  margin: 4px;
}

.warning {
  display: none;
  background: #ffecec;
  color: #900;
  padding: 8px;
  margin-bottom: 10px;
}
</style>
</head>

<body>

<div id="line-warning" class="warning">
⚠ LINE内ブラウザではカメラが使用できません。<br>
右上「︙」→「ブラウザで開く」を選択してください。
</div>

<h1>腕立て伏せ自動カウンター</h1>

<p>
カメラで骨格を検出し、<br>
腕立て伏せの回数を自動でカウントします。
</p>

<div id="container">
  <video id="video" playsinline></video>
  <canvas id="canvas"></canvas>
</div>

<div class="counter">
回数：<span id="count">0</span>
</div>

<div>
目標回数：
<input type="number" id="target" value="10" min="1">
</div>

<div>
<button id="start">スタート</button>
<button id="pause">一時停止</button>
<button id="reset">リセット</button>
</div>

<section>
<h2>使い方</h2>
<ol>
<li>カメラに正面を向いてください</li>
<li>スタートを押してください</li>
<li>腕立て伏せを行うと自動で回数がカウントされます</li>
</ol>
</section>

<script>
// LINE内ブラウザ検出
if (/Line/i.test(navigator.userAgent)) {
  document.getElementById("line-warning").style.display = "block";
}

// ===== 音声 =====
const countSound = new Audio("count.mp3");
const goalSound  = new Audio("goal.mp3");

function enableSound() {
  countSound.play().then(() => {
    countSound.pause();
    countSound.currentTime = 0;
  }).catch(()=>{});
}

// ===== 状態 =====
let count = 0;
let running = false;
let state = "up";

const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const countEl = document.getElementById("count");
const targetEl = document.getElementById("target");

// ===== Pose =====
const pose = new Pose({
  locateFile: file => `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`
});

pose.setOptions({
  modelComplexity: 1,
  minDetectionConfidence: 0.6,
  minTrackingConfidence: 0.6
});

pose.onResults(results => {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  if (!results.poseLandmarks) return;

  drawConnectors(ctx, results.poseLandmarks, POSE_CONNECTIONS,
    { color: "lime", lineWidth: 3 });
  drawLandmarks(ctx, results.poseLandmarks,
    { color: "red", radius: 4 });

  if (!running) return;

  const shoulderY =
    (results.poseLandmarks[11].y +
     results.poseLandmarks[12].y) / 2;

  if (shoulderY > 0.6) state = "down";

  if (shoulderY < 0.5 && state === "down") {
    state = "up";
    count++;
    countEl.textContent = count;

    countSound.currentTime = 0;
    countSound.play();

    if (count >= Number(targetEl.value)) {
      goalSound.play();
      running = false;
      alert("目標達成！");
    }
  }
});

// ===== Camera =====
const camera = new Camera(video, {
  onFrame: async () => {
    await pose.send({ image: video });
  },
  width: 640,
  height: 480
});

camera.start().catch(() => {
  alert("カメラを起動できません。HTTPSで開いてください。");
});

video.onloadedmetadata = () => {
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
};

// ===== Buttons =====
document.getElementById("start").onclick = () => {
  enableSound();
  running = true;
};

document.getElementById("pause").onclick = () => {
  running = false;
};

document.getElementById("reset").onclick = () => {
  running = false;
  count = 0;
  state = "up";
  countEl.textContent = 0;
};
</script>

</body>
</html>

